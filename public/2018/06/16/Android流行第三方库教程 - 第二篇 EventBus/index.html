<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Android流行第三方库教程 - 第二篇 EventBus · Zhao Weihao 's Blog</title><meta name="description" content="追求自由的少年"><meta name="og:title" content="Android流行第三方库教程 - 第二篇 EventBus"><meta name="og:type" content="website"><meta name="og:url" content="https://zhaoweihao.com/2018/06/16/Android流行第三方库教程 - 第二篇 EventBus/"><meta name="og:image"><meta name="og:description" content="追求自由的少年"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.jpg"><link rel="stylesheet" href="/css/chiangmai.css"><meta name="steem:author" content="@stunstunstun"><link rel="search" type="application/opensearchdescription+xml" href="https://zhaoweihao.com/atom.xml" title="Zhao Weihao 's Blog"><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Zhao Weihao 's Blog" type="application/atom+xml">
</head><body class="post"><div id="fb-root"></div><div class="wrap"><header><nav class="navi-post"><a class="navi-post-back" href="javascript:history.back()"><i class="fa fa-arrow-left" aria-hidden="true"></i></a><a class="navi-post-home" href="/"><i class="fa fa-home" aria-hidden="true"></i></a></nav></header><main class="post"><div class="post"><article class="post-block"><h1 class="post-title">Android流行第三方库教程 - 第二篇 EventBus</h1><div class="post-info"><div class="post-info-profile"><a href="/about/" target="_blank"><img src="/image/profile.jpg"></a></div><div class="post-info-details"><div class="post-categories"><a href="/categories/Android" target="_self"><span>ANDROID</span></a></div><div class="post-date">Jun 16, 2018</div></div></div><div class="post-share"><div class="fb-like" data-href="https://zhaoweihao.com/2018/06/16/Android流行第三方库教程 - 第二篇 EventBus/" data-layout="button_count" data-action="like" data-size="small" data-show-faces="true" data-share="false">                 </div><div class="fb-share-button" data-href="https://zhaoweihao.com/2018/06/16/Android流行第三方库教程 - 第二篇 EventBus/" data-layout="button" data-size="small" data-mobile-iframe="true"></div></div><div class="post-content"><p>这是系列的第二篇，这次主要介绍EventBus的配置和简单使用</p>
<p>先来看看官方的介绍：</p>
<blockquote>
<p>EventBus is an open-source library for Android and Java using the publisher/subscriber pattern for loose coupling. EventBus enables central communication to decoupled classes with just a few lines of code – simplifying the code, removing dependencies, and speeding up app development.</p>
</blockquote>
<blockquote>
<p>翻译：EventBus 是一个为了解耦而生的开源的Android和Java库，使用发布者和订阅者模式。EventBus用几行代码来实现中央通讯去解耦各个类 - 简化代码，去除依赖，还加快APP开发效率。</p>
</blockquote>
<p>好了，官方说明好像说的挺厉害的，那到底对于初学者来说EventBus能用在些什么地方呢？现在先来假设一种情况，你的某一个Activity中的Fragment中的Fragment想去执行另外一个Activity中Fragment的方法，这时候该怎么办，该是用Fragment和Activity通信去干吗？唔，也许可以，但是你得想想，这时候就要Fragment和Activity通信，然后Activity再和Acitivyt通信，最后Acitivy和Fragment通信，似乎有些复杂。。。，或许可以使用接口，或许可以使用广播，但是代码都不会少，而且都会有些复杂。</p>
<p>这时候EventBus就可以横空出世了，接下来就来看看用EventBus怎么做吧，当然EventBus的用武之地肯定不止这些，靠大家自己去想象吧。</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>先在 app/build.gradle中添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &#39;org.greenrobot:eventbus:3.1.1&#39;</span><br></pre></td></tr></table></figure>
<h2 id="EventBus-三部曲"><a href="#EventBus-三部曲" class="headerlink" title="EventBus 三部曲"></a>EventBus 三部曲</h2><h3 id="1-定义事件："><a href="#1-定义事件：" class="headerlink" title="1.定义事件："></a>1.定义事件：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageEvent</span> </span>&#123; <span class="comment">/* Additional fields if needed */</span> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-准备订阅者："><a href="#2-准备订阅者：" class="headerlink" title="2.准备订阅者："></a>2.准备订阅者：</h3><p>声明和注释你的订阅方法，另外还可以指定进程模式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Subscribe</span>(threadMode = ThreadMode.MAIN)  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessageEvent</span><span class="params">(MessageEvent event)</span> </span>&#123;<span class="comment">/* Do something */</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>注册和注销你的订阅者。在Android中的例子，Activity和Fragment应该通常根据他们生命周期注册：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onStart();</span><br><span class="line">    EventBus.getDefault().register(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onStop();</span><br><span class="line">    EventBus.getDefault().unregister(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="3-发布事件："><a href="#3-发布事件：" class="headerlink" title="3.发布事件："></a>3.发布事件：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EventBus.getDefault().post(<span class="keyword">new</span> MessageEvent());</span><br></pre></td></tr></table></figure>

<h2 id="实际例子"><a href="#实际例子" class="headerlink" title="实际例子"></a>实际例子</h2><p>例如我在登录成功后需要更新某些页面</p>
<h3 id="1-先定义事件："><a href="#1-先定义事件：" class="headerlink" title="1.先定义事件："></a>1.先定义事件：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageEvent</span> </span>&#123; <span class="comment">/* Additional fields if needed */</span> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-发送事件"><a href="#2-发送事件" class="headerlink" title="2.发送事件"></a>2.发送事件</h3><p>在登录完成后发送事件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EventBus.getDefault().post(<span class="keyword">new</span> MessageEvent());</span><br></pre></td></tr></table></figure>

<h3 id="3-接受事件："><a href="#3-接受事件：" class="headerlink" title="3.接受事件："></a>3.接受事件：</h3><p>在需要更新的页面也注册EventBus，这里是在onCreate方法和onDestroy方法是因为当登录成功发送事件那时候需要更新的页面先前是执行过onStop方法的，如果放在onStart和onStop的话就不能捕获到事件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    <span class="comment">// 注册EventBus</span></span><br><span class="line">    EventBus.getDefault().register(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 注销EventBus</span></span><br><span class="line">    EventBus.getDefault().unregister(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">super</span>.onDestroy();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着当接受到事件的时候在主进程更新UI</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Subscribe</span>(threadMode = ThreadMode.MAIN)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessageEvent</span><span class="params">(LoginActivity.MessageEvent event)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 在这里更新UI的操作</span></span><br><span class="line">    requestTecOrStu();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h2><p>更详细的使用教程可以参考官方文档：<a href="http://greenrobot.org/eventbus/documentation/" target="_blank" rel="noopener">http://greenrobot.org/eventbus/documentation/</a></p>
<h2 id="Contact"><a href="#Contact" class="headerlink" title="Contact"></a>Contact</h2><p><a href="mailto:zhaoweihao.dev@gmail.com">zhaoweihao.dev@gmail.com</a></p>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2018/06/15/Android%E6%B5%81%E8%A1%8C%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E6%95%99%E7%A8%8B%20-%20%E7%AC%AC%E4%B8%80%E7%AF%87%20ButterKnife/"><i class="fa fa-arrow-left" aria-hidden="true"></i></a><a class="next" href="/2018/06/17/Android%E5%A4%8D%E4%B9%A0%E7%AF%87-%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6%E4%B9%8BActivity/"><i class="fa fa-arrow-right" aria-hidden="true"></i></a></div><div class="copyright"><p>© 2017 - 2020 <a href="https://github.com/zhaoweih" target="_blank">Satoshi Chiu</a>. Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/stunstunstun/hexo-theme-chiangmai" target="_blank">hexo-theme-chiangmai</a>.</p></div></footer></div></body></html>