<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Android开发笔记 · Zhao Weihao 's Blog</title><meta name="description" content="追求自由的少年"><meta name="og:title" content="Android开发笔记"><meta name="og:type" content="website"><meta name="og:url" content="https://zhaoweihao.com/2017/12/07/Android开发笔记/"><meta name="og:image"><meta name="og:description" content="追求自由的少年"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.jpg"><link rel="stylesheet" href="/css/chiangmai.css"><meta name="steem:author" content="@stunstunstun"><link rel="search" type="application/opensearchdescription+xml" href="https://zhaoweihao.com/atom.xml" title="Zhao Weihao 's Blog"><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Zhao Weihao 's Blog" type="application/atom+xml">
</head><body class="post"><div id="fb-root"></div><div class="wrap"><header><nav class="navi-post"><a class="navi-post-back" href="javascript:history.back()"><i class="fa fa-arrow-left" aria-hidden="true"></i></a><a class="navi-post-home" href="/"><i class="fa fa-home" aria-hidden="true"></i></a></nav></header><main class="post"><div class="post"><article class="post-block"><h1 class="post-title">Android开发笔记</h1><div class="post-info"><div class="post-info-profile"><a href="/about/" target="_blank"><img src="/image/profile.jpg"></a></div><div class="post-info-details"><div class="post-categories"></div><div class="post-date">Dec 7, 2017</div></div></div><div class="post-share"><div class="fb-like" data-href="https://zhaoweihao.com/2017/12/07/Android开发笔记/" data-layout="button_count" data-action="like" data-size="small" data-show-faces="true" data-share="false">                 </div><div class="fb-share-button" data-href="https://zhaoweihao.com/2017/12/07/Android开发笔记/" data-layout="button" data-size="small" data-mobile-iframe="true"></div></div><div class="post-content"><p>我最近在学校期末作业使用Kotlin语言做一个校园社区Android APP，仍然在制作中。。。</p>
<p>Github项目地址：<a href="https://github.com/zhaoweihaoChina/hnuplus" target="_blank" rel="noopener">https://github.com/zhaoweihaoChina/hnuplus</a></p>
<p>这是我用记录一些我在做的时候需要记录的东西，用来以后翻看。也给需要的同学做个参考。</p>
<h5 id="Activity-调用-Fragment的公共方法"><a href="#Activity-调用-Fragment的公共方法" class="headerlink" title="Activity 调用 Fragment的公共方法"></a>Activity 调用 Fragment的公共方法</h5><p>首先创建一个接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyInterface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">myAction</span><span class="params">()</span> </span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你的fragment必须声明这个接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> MyFragment extends Fragment implements MyInterface</span><br></pre></td></tr></table></figure>

<p>在你的Activity中，定义一个MyInterface类型的字段</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> MyInterface listener ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setListener</span><span class="params">(MyInterface listener)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.listener = listener ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当创建你的fragment时添加它</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setListener(myFragment);</span><br></pre></td></tr></table></figure>

<p>最后，当你想要在activity中调用fragment的方法时可以：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">listener.myAction() ; <span class="comment">// 这将调用MyFragment类中的方法</span></span><br></pre></td></tr></table></figure>

<h5 id="Fragment-调用-Activity的公共方法"><a href="#Fragment-调用-Activity的公共方法" class="headerlink" title="Fragment 调用 Activity的公共方法"></a>Fragment 调用 Activity的公共方法</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((YourActivityClassName)getActivity()).yourPublicMethod();</span><br></pre></td></tr></table></figure>

<h5 id="保存List到SharedPreferences中"><a href="#保存List到SharedPreferences中" class="headerlink" title="保存List到SharedPreferences中"></a>保存List<Object>到SharedPreferences中</h5><p><code>Kotlin</code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//保存</span></span><br><span class="line"><span class="comment">//这是在Fragment里保存的代码</span></span><br><span class="line"><span class="keyword">val</span> postList: List&lt;Post&gt; = ... <span class="comment">//你需要保存的list</span></span><br><span class="line"><span class="keyword">val</span> appSharedPrefs = PreferenceManager</span><br><span class="line">        .getDefaultSharedPreferences(activity.applicationContext)</span><br><span class="line"><span class="keyword">val</span> prefsEditor = appSharedPrefs.edit()</span><br><span class="line"><span class="keyword">val</span> gson = Gson()</span><br><span class="line"><span class="keyword">val</span> json = gson.toJson(postList)</span><br><span class="line">prefsEditor.putString(<span class="string">"MyObject"</span>, json)</span><br><span class="line">prefsEditor.commit()</span><br><span class="line"><span class="comment">//读取</span></span><br><span class="line"><span class="comment">//这是在Fragment里读取的代码</span></span><br><span class="line"><span class="keyword">val</span> appSharedPrefs = PreferenceManager</span><br><span class="line">                        .getDefaultSharedPreferences(activity.getApplicationContext())</span><br><span class="line"><span class="keyword">val</span> gson = Gson()</span><br><span class="line"><span class="keyword">val</span> json = appSharedPrefs.getString(<span class="string">"MyObject"</span>, <span class="string">""</span>)</span><br><span class="line"><span class="keyword">val</span> type = <span class="keyword">object</span> : TypeToken&lt;List&lt;Post&gt;&gt;() &#123;</span><br><span class="line">&#125;.type</span><br><span class="line"><span class="keyword">val</span> postList: List&lt;Post&gt; = gson.fromJson(json,type)</span><br></pre></td></tr></table></figure>

<h5 id="Uri-转换成Path"><a href="#Uri-转换成Path" class="headerlink" title="Uri 转换成Path"></a>Uri 转换成Path</h5><p><code>Kotlin</code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//uri to path</span></span><br><span class="line"><span class="keyword">var</span> path: String? = <span class="literal">null</span></span><br><span class="line"><span class="keyword">val</span> uri = Matisse.obtainResult(<span class="keyword">data</span>)[<span class="number">0</span>]<span class="comment">//你需要转换的uri</span></span><br><span class="line">listener!!.showImage(uri)</span><br><span class="line"><span class="keyword">val</span> filePathColumn = arrayOf(MediaStore.Images.Media.DATA)</span><br><span class="line"><span class="keyword">val</span> cursor = contentResolver.query(uri, filePathColumn, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>)</span><br><span class="line"><span class="keyword">if</span> (cursor!!.moveToFirst()) &#123;</span><br><span class="line">    <span class="keyword">val</span> columnIndex = cursor.getColumnIndex(filePathColumn[<span class="number">0</span>])</span><br><span class="line">    path = cursor.getString(columnIndex)<span class="comment">//输出的path</span></span><br><span class="line">    Log.d(<span class="string">"PA"</span>,path)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//boooo, cursor doesn't have rows ...</span></span><br><span class="line">&#125;</span><br><span class="line">cursor.close()</span><br></pre></td></tr></table></figure>

<h5 id="在Fragment中使用Kotlin-android-extensions"><a href="#在Fragment中使用Kotlin-android-extensions" class="headerlink" title="在Fragment中使用Kotlin-android-extensions"></a>在Fragment中使用Kotlin-android-extensions</h5><p><code>Kotlin</code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onViewCreated</span><span class="params">(view: <span class="type">View</span>?, savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onViewCreated(view, savedInstanceState)</span><br><span class="line">    btn_pic!!.setOnClickListener &#123;<span class="comment">//btn_pic是我在布局定义的按钮id名字</span></span><br><span class="line">      <span class="comment">//逻辑代码</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="联系我"><a href="#联系我" class="headerlink" title="联系我"></a>联系我</h3><p><a href="mailto:zhaoweihaochn@foxmail.com">zhaoweihaochn@foxmail.com</a></p>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2017/11/04/%E8%87%AA%E5%BB%BAssr%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%99%E7%A8%8B/"><i class="fa fa-arrow-left" aria-hidden="true"></i></a><a class="next" href="/2017/12/07/%E5%9C%A8Android%E4%B8%AD%E5%88%9B%E5%BB%BA%E7%B1%BB%E4%BC%BCInstagram%E7%9A%84%E6%B8%90%E5%8F%98%E8%83%8C%E6%99%AF/"><i class="fa fa-arrow-right" aria-hidden="true"></i></a></div><div class="copyright"><p>© 2017 - 2020 <a href="https://github.com/zhaoweih" target="_blank">Satoshi Chiu</a>. Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/stunstunstun/hexo-theme-chiangmai" target="_blank">hexo-theme-chiangmai</a>.</p></div></footer></div></body></html>